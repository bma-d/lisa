# Breadcrumbs 2026-02-20

- **01:35:24**: Add strict monitor turn-complete mode + transcript safety fix
  Implemented --waiting-requires-turn-complete for session monitor; added waiting_input_turn_complete exit reason; fixed Claude capture fallback to raw when prompt/createdAt metadata missing; updated Codex transcript parser to skip task_complete/task_started/agent_reasoning event messages; added regression tests and validated with go test ./... and live CLI runs.
- **01:35:25**: Refresh context docs for monitor/capture changes
  Updated .agents/sdk-usage.md and src/.agents/testing.md with strict monitor mode and promptless transcript fallback behavior.
- **01:37:35**: Harden strict turn-complete mode for Codex transcripts
  Updated codex transcript completion parser to skip non-terminal event_msg entries (task_complete/task_started/agent_reasoning), enabling monitor --waiting-requires-turn-complete to work on Codex interactive sessions; added regression in src/codex_session_test.go.
- **01:37:36**: Split new monitor/capture tests into dedicated files
  Moved new strict monitor tests into src/monitor_waiting_turn_complete_test.go and Claude capture fallback test into src/claude_capture_fallback_test.go to keep command_coverage_test.go near target size and reduce growth in large test files.
- **02:34:33** (`src/status.go`): Fix interactive custom-command waiting detection
  Treat stdin-only cat descendants as passive so monitor --stop-on-waiting reaches waiting_input for interactive custom command sessions instead of timing out; added regressions and e2e coverage.
- **02:34:37** (`src/commands_session.go`): Prioritize session send argument validation
  Reordered cmdSessionSend validation to fail fast on invalid --text/--keys combinations before tmux session lookup; added unit coverage for validation-order behavior.
- **02:34:41** (`src/.agents/state-machine.md`): Refresh state-machine context docs
  Documented stdin-only cat descendant handling in interactive idle detection and updated Last Updated date after waiting_input reliability fix.
- **03:32:17**: Fix session-list missing-socket handling and codex noise filter
  Normalized tmux list-sessions missing-socket errors to empty list for project-scoped list flows; wrapped unexpected tmux list errors with stderr output; expanded raw capture noise filtering for Codex MCP OAuth invalid_grant/auth-refresh lines and continuation fragments; added regression tests.
- **03:32:18**: Refresh context docs for tmux/capture behavior
  Updated src/.agents/tmux-layer.md and .agents/sdk-usage.md to document missing-socket normalization and expanded default raw noise filtering coverage.
- **03:33:11**: Document nested prompt quoting guidance
  Updated USAGE.md and .agents/sdk-usage.md with heredoc-based --prompt guidance for deep nested agent chains to avoid shell quoting collisions.
- **04:08:09**: Fix nested codex + session tree kill
  Patched tmux socket routing to prefer /tmp with legacy fallback, added nested codex exec auto-bypass heuristic for Lisa prompts, added parentSession metadata and descendant-aware cmdSessionKill cascade, added status --fail-not-found, updated help/USAGE, and added regression coverage.
- **04:08:10**: Refresh context docs
  Updated .agents/sdk-usage.md, src/.agents/session-lifecycle.md, and src/.agents/tmux-layer.md to document nested codex bypass behavior, parentSession metadata, descendant kill cascade, and tmux socket routing updates.
