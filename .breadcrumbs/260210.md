# Breadcrumbs 2026-02-10

- **00:14:16**: Add multi-channel install/release pipeline
  Added GoReleaser config + CI/release workflows + README install matrix; updated module path for go install and added lisa version output for package-manager verification.
- **00:14:16**: Refresh agent context after release tooling changes
  Updated .agents/project-overview.md and .agents/conventions.md to document GoReleaser-based distribution and new root file structure.
- **00:54:11** (`src/status.go`): Fix status heuristics and cleanup reliability
  Narrowed prompt-wait detection to recent output, fixed zero-CPU process detection, and expanded artifact cleanup to remove session files across project hashes.
- **00:54:11** (`src/regressions_test.go`): Add regression coverage for fixed issues
  Added tests for prompt marker false-positives, zero-CPU process matching, cross-project artifact cleanup, and doctor JSON build metadata payload.
- **00:54:11** (`.agents/conventions.md`): Postflight context sync check
  Reviewed context files after fixes; no AGENTS/.agents updates required because changes were targeted bug fixes without new architecture or conventions.
- **01:57:48** (`src/commands_session.go`): Fix kill ordering
  session kill/kill-all now terminate tmux sessions before artifact cleanup so cleanup errors cannot leave sessions running
- **01:57:49** (`src/commands_agent.go`): Harden doctor flags
  doctor now rejects unknown flags and matches CLI flag parsing behavior
- **01:57:50** (`src/regressions_test.go`): Add regression coverage
  added tests for doctor unknown flags and kill/kill-all ordering under cleanup failures
- **02:21:40** (`src/status.go`): Harden exec completion marker detection
  parseExecCompletion now only trusts markers at pane tail and ignores stale historical markers with substantive trailing output.
- **02:21:40** (`src/commands_session.go`): Tighten CLI parsing and test seams
  session spawn now uses injectable tmux function vars for tests; monitor --stop-on-waiting now validates strict boolean values.
- **02:21:40** (`src/regressions_test.go`): Add regression coverage for found issues
  Added tests for Run(version), parseExecCompletion stale marker behavior, session spawn parsing/json path, and invalid stop-on-waiting values.
- **02:21:45**: Postflight context sync
  Reviewed .agents context after fixes; no AGENTS/.agents updates required because changes align with existing documented patterns (function-variable mocking and manual flag parsing).
- **03:51:59**: Fix review findings
  Made session status/monitor CSV-safe, cleaned artifacts on spawn send failure, switched session commands to mockable tmux function vars, added regression tests and docs updates.
- **04:06:06**: Address post-commit review findings
  Tightened exec completion prompt-tail checks to avoid false positives on trailing '>' output, made --stop-on-waiting strict true|false parsing, and added regressions for both behaviors.
- **04:35:19**: Fix status prompt heuristic and missing-session cleanup
  Prevent false waiting_input on tag-like Claude tails, preserve active status for busy agents, and run artifact cleanup even when tmux session is missing; added regression tests.
- **04:35:20**: Refresh JSON output guidance in context docs
  Updated .agents/conventions.md and .agents/project-overview.md to document exact commands that support --json vs text-only helpers.
- **04:46:14**: Fix review findings: exec wrapper, shell detection, docs wording
  Made exec wrapper resilient to errexit shells, expanded shell detection (pwsh/tcsh/etc + *sh), added regression tests, and corrected architecture wording from deterministic to unique session names.
- **04:46:18**: Postflight context sync check
  Reviewed .agents context for staleness after fixes; no AGENTS/.agents updates required because behavior changes are covered by code/tests and existing context remains accurate.
- **04:58:11** (`src/commands_session.go`): Enforce session naming contract
  session spawn now requires custom --session names to start with lisa-; added regression test coverage
- **04:58:11** (`.goreleaser.yaml`): Drop unsupported Windows release targets
  removed windows build/scoop packaging and documented macOS/Linux support in README
- **04:58:11** (`.agents/project-overview.md`): Refresh context after release/sessions changes
  updated context docs for release channels and custom session naming expectations
- **04:58:25** (`.agents/sdk-usage.md`): Update SDK context timestamp
  bumped Last Updated and documented lisa- prefix requirement for custom session names
- **05:09:49** (`src/regressions_test.go`): Add regression tests for tmux list-sessions empty-state
  Added fake-tmux PATH tests covering no-server->empty-list and unexpected stderr->error behavior.
- **05:09:49** (`src/tmux.go`): Handle empty tmux server state in list-sessions
  Treat 'no server running/no sessions' tmux output as empty list so session list/kill-all succeed with zero sessions.
- **05:10:06** (`src/.agents/tmux-layer.md`): Refresh tmux context doc for empty-session behavior
  Documented tmuxListSessions no-server/no-sessions normalization and updated Last Updated date.
- **15:00:41** (`src/session_wrapper.go`): Add session lifecycle wrapper + heartbeat
  Wrapped startup commands with __LISA_SESSION_START__/__LISA_SESSION_DONE__ markers and heartbeat file updates; status now uses heartbeat freshness and session done markers for more accurate in_progress/completed/crashed detection.
- **15:00:45** (`src/.agents/state-machine.md`): Refresh context docs for wrapper status model
  Updated src/.agents state-machine, tmux-layer, and session-lifecycle docs with heartbeat artifact/env and session wrapper markers to keep JIT context accurate.
- **15:35:47** (`src/status.go`): Implement run-id markers + heartbeat mtime observability
  Added tokenized session done parsing, mtime-based heartbeat freshness, classificationReason/signals fields, state-file locking, and per-session JSONL transition/snapshot event logging in computeSessionStatus.
- **15:35:53** (`src/commands_session_explain.go`): Add session explain diagnostics command
  Introduced 'lisa session explain' with JSON/text outputs, surfaced reason/signals/event tail, and expanded tests around marker mismatch, signal trap handling, explain payloads, and concurrent state polling.
- **17:06:58**: Hardening: lock timeout, event retention, process-scan cache
  Added bounded state lock acquisition with timeout signals; resilient event tail parsing with dropped-line counts; bounded event log trimming; process scan caching and batched pane snapshot reads; spawn now fail-fast on metadata persistence errors; split session command handlers for maintainability; added Codex E2E coverage and updated docs.
- **17:07:04**: Context sync
  Updated src/.agents/state-machine.md, session-lifecycle.md, and testing.md to reflect lock timeout fallback, bounded event logs, process scan caching, metadata fail-fast spawn semantics, and Codex E2E test coverage.
- **17:25:59**: Stability/observability hardening
  Addressed review findings: meta/state/event error signals, lock-timeout degraded state, cleanup-on-kill-failure, regex precompile, expanded tests.
- **17:26:03**: Context docs refreshed
  Updated README and AGENTS context files with degraded state and new infra observability signals.
- **17:29:04**: Follow-up hardening
  Added monitor degraded terminal handling, reduced event append trim I/O, updated docs, and added monitor degraded regression coverage.
- **18:07:18**: Hardening pass
  Added command timeouts, event-file locking/retention fixes, agent scan error signaling, starship prompt marker parsing fix, and expanded regression/integration test coverage.
- **18:07:56**: Context refresh
  Updated src/.agents docs for process-scan degraded state, command timeout behavior, event-lock retention, and new hermetic interactive integration coverage.
- **18:26:13**: Stability hardening
  Decoupled event writes from state lock, added tmux-read degraded fallback with tmuxReadError signal, and made output freshness updates monotonic under concurrent polls.
- **18:26:18**: Context sync
  Updated src/.agents/state-machine.md and src/.agents/testing.md to reflect tmux-read degraded signaling, monotonic freshness updates, lock-decoupled event writes, and new command_coverage_test.go.
- **18:29:39**: Follow-up hardening
  Reduced tmux read-error event noise for one-shot polls, replaced deprecated title-casing path with explicit display helper, and added command/regression tests for new behavior.
- **18:59:46**: Harden status monitoring + freshness ordering
  Monitor no longer treats degraded as terminal; status reads pane snapshot before capture and preserves terminal pane classification on capture errors; output freshness now uses nanosecond monotonic guard; added process-list cache and regression tests.
- **19:00:18**: Refresh context docs for monitor/cache semantics
  Updated README + .agents SDK/state-machine/tmux-layer docs for non-terminal degraded monitor behavior, capture-terminal fallback, and process-list cache env.
- **19:43:03**: Stability and observability hardening
  Added CI race + E2E jobs, reduced duplicate tmux capture in status path, optimized event log trimming with line-count sidecar, added lifecycle event emission (spawn/send/monitor/kill), split status helpers into status_helpers.go, and added focused coverage tests.
- **19:46:48**: Complete hardening pass
  Added routing/coverage tests, raised statement coverage to 79.8% (no core function below 60%), gofmt + full/race/e2e-interactive verification all passing.
- **21:14:02**: Hardened completion detection and status observability
  Added done-file completion sidecar wiring (spawn env, wrapper write, status read), stricter agent process matching, per-session agent/mode cache in state, and richer session status --full text signals. Added regression tests for invalid height/events/list error, done-file behavior, and race-safe interrupt wrapper test.
- **21:14:07**: Updated JIT context docs for new runtime behavior
  Refreshed src/.agents/state-machine.md, src/.agents/tmux-layer.md, and src/.agents/session-lifecycle.md with done-file artifact, stricter process matching defaults, and cached agent/mode resolution details.
- **21:23:19**: Added hermetic exec-mode E2E coverage
  Introduced src/e2e_exec_fake_test.go to exercise spawn->monitor->capture for exec mode using a local command under tmux (no external agent dependency), reducing reliance on opt-in real-agent E2E for core lifecycle regression detection.
- **21:23:37**: Refreshed testing context for hermetic exec E2E
  Updated src/.agents/testing.md with new e2e_exec_fake_test coverage and current test-layer description.
- **21:27:42**: Closed remaining post-audit risks
  Addressed additional issues by adding status --full schema tag, tightening wrapper-aware process detection to avoid flag-value false positives, and degrading classification on malformed done-file payloads. Added regressions for wrapper detection and malformed done-file handling.
- **21:27:46**: Refined context docs for final hardening pass
  Updated src/.agents/tmux-layer.md and src/.agents/state-machine.md to reflect wrapper-aware process detection and done-file corruption degradation behavior.
- **21:45:05**: Hardened cleanup + monitor observability
  Fixed state lock wait propagation into events, scoped artifact cleanup to project hash by default (opt-in cross-hash via LISA_CLEANUP_ALL_HASHES), cleaned spawn failure artifacts on tmux create errors, reordered kill/kill-all lifecycle append before cleanup to avoid artifact recreation, and added regression coverage for waiting-input/verbose monitor paths.
- **21:45:12**: Updated context docs for lifecycle changes
  Refreshed src/.agents/session-lifecycle.md and src/.agents/state-machine.md to document kill/kill-all ordering, hash-scoped cleanup defaults with LISA_CLEANUP_ALL_HASHES override, spawn cleanup behavior on tmux create failure, and state-lock wait propagation in event payloads.
- **21:51:59**: Addressed additional post-fix issues
  Implemented durable kill observability by preserving session event logs during kill/kill-all cleanup, added explicit --cleanup-all-hashes flag for spawn/kill/kill-all cross-hash cleanup, and hash-scoped long-command script paths/patterns to prevent cross-project temp-script collisions. Updated related regressions and command tests.
- **21:52:05**: Synced context docs for cleanup/script updates
  Updated src/.agents/session-lifecycle.md and src/.agents/tmux-layer.md to reflect hash-scoped script paths, kill/kill-all cleanup/event ordering, and --cleanup-all-hashes CLI behavior.
- **22:15:21**: Hardened lifecycle observability and cleanup semantics
  Fixed root PID agent detection, added spawn failure lifecycle events, made kill-all cross-hash cleanup default when not project-only, and added shared-lock + large-line safe event-tail reads with regression tests.
- **22:15:27**: Refreshed JIT context docs for lifecycle/tmux changes
  Updated src/.agents/session-lifecycle.md and src/.agents/tmux-layer.md to document spawn failure events, kill-all cross-hash cleanup behavior, shared event-tail lock, and root-process matching in detectAgentProcess.
- **22:25:18**: Reduced event-log trim cost and added retention pruning
  Changed event log trimming to bounded tail-window compaction, added stale event artifact pruning (LISA_EVENT_RETENTION_DAYS), wired prune into spawn/kill/kill-all, and added regression tests for lock-timeout/large-line/toggle cleanup behavior.
- **22:25:22**: Updated lifecycle context docs for retention + bounded trim
  Extended src/.agents/session-lifecycle.md with bounded trim-window behavior and stale event artifact retention policy details.
