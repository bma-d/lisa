# Breadcrumbs 2026-02-23

- **00:26:24** (`skills/lisa/SKILL.md`): Audit Lisa skill contracts vs CLI
  Executed broad ./lisa matrix on isolated tmux socket, including nested detection phrasing and 4-level smoke with codex-spark; documented observed JSON/exit nuances.
- **00:26:25** (`skills/lisa/data/commands.md`): Clarify Lisa command contracts
  Updated skill docs with cursor-file hard-error requirements, bounded monitor guidance, list json-min shape notes, smoke report-min omissions, and success payload shape caveats for checkpoint/dedupe/aggregate.
- **00:27:49** (`skills/lisa/data/commands.md`): Clarify skills install args
  Documented skills install argument names: --to, --project-path, --path, --repo-root; prevents unknown-flag mistakes.
- **00:28:42** (`skills/lisa/SKILL.md`): Reapply skill clarifications after sync
  skills sync test rewrote repo skill files; reapplied SKILL and validation clarifications for cursor-file guardrails, monitor timeout hygiene, and report-min payload caveats.
- **00:30:08** (`skills/lisa/data/commands.md`): Expand command output-shape notes
  Added route runbook object shape, prompt-lint warnings schema, cursor-file hard-error semantics, tree delta-json flags, and smoke report-min payload caveat.
- **00:56:18**: Completed feature implementation + contract sync
  Finished all requested feature ideas: added session contract-check, monitor timeout-seconds, prompt-lint strict, aggregate dedupe, route profile, handoff compress, explain since cursor, list watch-json stream, smoke export artifacts, skills doctor contract-check; aligned help/capabilities/tests; gofmt + go test ./... green.
- **00:58:06**: Closed contract drift end-to-end
  session contract-check now passes in repo docs; skills install synced repo skill into ~/.codex/skills/lisa and ~/.claude/skills/lisa; skills doctor --contract-check now reports both targets up_to_date.
- **01:07:02**: Add review-driven help/capabilities/skills-doctor tests
  Added negative help route, capabilities help+unknown-flag text-path tests, and skills doctor missing_flag_value + contract-check missingFlags coverage in owned test files.
- **01:52:32**: Fix watch-json contract + docs parity
  Fixed session list watch-json to always enforce --json-min; aligned help default watch interval to 2s; synced skill command docs for monitor/event flags and extended command flag surfaces; added regression tests for watch-json, handoff compress, smoke export, route profile, and active-only list filtering.
- **02:42:37**: lisa skill validation + docs hardening
  Ran exhaustive ./lisa command matrix (session/oauth/skills/smoke/autopilot/nested triggers) on isolated socket; updated skills/lisa/SKILL.md + data/validation.md + data/feature-ideas.md with verified contract notes, webhook/guard/chaos-report edge behavior, and scored proposed context-optimization features.
- **02:42:42**: context refresh completed
  Synced Lisa skill guidance with validated runtime behavior and appended proposed LLM-focused feature backlog with impact scoring.
- **03:21:50**: Implemented all Lisa context-optimization feature ideas
  Added session objective/memory/lane, handoff schema v2, route queue, monitor auto-recover, diff-pack semantic-only, budget-plan, guard policy-file, smoke llm-profile; created scripts/lisa-contract-matrix.sh; updated skill docs/contracts; rebuilt ./lisa and verified go test + contract matrix + session/skills contract checks.
- **03:33:13** (`src/commands_session.go`): Fix objective reminder prepend guard
  cmdSessionSend now prepends objective reminder when objective context exists without goal and avoids duplicate reminders via structured presence check.
- **03:33:13** (`src/commands_session_orchestration.go`): Enforce handoff schema v2 lane contract
  cmdSessionHandoff now rejects schema v1 with errorCode handoff_schema_v2_required when lane contract requires handoff v2.
- **03:33:14** (`src/session_send_handoff_contract_fix_test.go`): Add focused regressions for send/handoff
  Added tests for objective reminder propagation with empty goal and lane-contract schema v2 enforcement in JSON/text modes.
- **03:38:29**: Add direct lane/memory command contract tests
  Added focused direct tests for session lane CRUD JSON and session memory refresh JSON payload (delta metadata/path), plus CI contract-matrix workflow job.
- **03:53:32**: Add changelog entry for review/fix cycle
  Appended docs/changelog/260223.md with objective/lane contract fixes, direct tests, and CI contract-matrix QA notes before commit/build.
- **04:22:49** (`.agents/sdk-usage.md`): Refresh interactive marker-gating docs
  Documented monitor stop-on-waiting caveat for multi-turn marker workflows, session send objective-reminder behavior, and updated testing context index with new E2E file.
- **04:22:49** (`src/e2e_interactive_followup_fake_test.go`): Add multi-turn interactive follow-up E2E
  Added hermetic test covering spawn->send(marker1)->monitor->send(marker2)->monitor in same session with stop-on-waiting=false and capture assertions.
- **05:07:20** (`src/tmux.go`): Stabilize tmux paste cleanup ordering
  tmuxSendText now deletes paste buffer immediately after paste (and before optional enter) to avoid lingering buffer-state timing effects in interactive TUIs.
- **05:07:20** (`src/commands_session.go`): Harden codex interactive send-enter path
  For codex interactive sessions, session send now routes --text --enter through staged submit semantics (text send + explicit Enter key path) to match proven two-step behavior and prevent stuck follow-up turns.
- **05:23:44**: Skill audit + sync
  Ran exhaustive ./lisa command matrix in isolated socket/root, captured contract discrepancies, and validated edge behaviors (nested detection, webhook failure, guard strict risk, monitor handoff stream).
- **05:23:45**: Refresh lisa skill docs
  Updated skills/lisa/SKILL.md + data/{commands,validation,feature-ideas}.md to align with lisa capabilities/contracts and added proposed context-optimization features with scores.
- **05:25:31**: Document diff-pack discrepancy
  Recorded validated runtime mismatch: session diff-pack may emit session_not_found while session status/exists remain true; documented fallback to context-pack/handoff.
- **06:33:59**: Implement round4 context features
  Fixed diff-pack runtime-env bug; added session loop/context-cache/budget-observe, route concurrency, handoff schema v3 IDs, aggregate delta-json, prompt-lint rewrite flag, memory semantic-diff, anomaly auto-remediate, skills doctor sync-plan; refreshed skill docs + contract coverage.
- **06:34:36**: Sync installed lisa skills
  Ran ./lisa skills install --to codex|claude and verified ./lisa skills doctor --contract-check --sync-plan --json returns ok=true (repo + installed skills in sync).
- **06:54:33**: Subagent review loop clean
  Ran parallel explorer review -> worker fixes -> full validation -> second explorer review. Final reviewer statuses: CLEAN/CLEAN/CLEAN.
- **07:49:41**: Subagent review loop clean
  Resolved ambiguity signaling gaps (JSON/non-JSON), hardened root resolution callsites, added event-prune lock discipline, expanded regressions; final 3-explorer cycle returned CLEAN.
- **16:18:00**: Fix context-pack from-handoff v2 parsing
  Updated handoff input parsing to accept v2/v3 nextAction object payloads in session context-pack; added regression test and rebuilt lisa binary.
- **16:18:01**: Update lisa skill docs for handoff contracts
  Documented handoff_v2_required schema caveat, context-pack from-handoff semantics, and updated recipes/help/USAGE; synced skills to codex/claude installs.
- **16:18:19**: Refresh SDK context for handoff/context-pack
  Updated .agents/sdk-usage.md with handoff_v2_required schema requirement and context-pack from-handoff v2/v3 nextAction object support.
- **16:25:08**: Fix handoff recent parsing + context-pack nextAction fallback tests
  Return error on malformed handoff recent in fallback parse; preserve/validate nextOffset+recent assertions; add command-only nextAction fallback test for context-pack.
- **17:08:09**: docs-feedback
  added tmux inactive monitoring incident doc
- **17:22:58** (`src/status.go`): Fix heartbeat no-PID classification
  Classify fresh-heartbeat/no-agent-pid sessions as in_progress with explicit reason heartbeat_fresh_agent_pid_unresolved; added regression coverage in session_wrapper_test.
- **17:23:02** (`src/tmux.go`): Broaden agent process detection wrappers
  Expanded detectAgentProcess matching to include executable aliases and nested wrapper chains (timeout/env/shell -c); added regressions for env wrapping, nested wrappers, and claude-code alias detection.
- **17:23:12** (`src/.agents/state-machine.md`): Refresh context docs for monitoring fix
  Updated state-machine and tmux-layer context notes for new heartbeat fallback reason and expanded wrapper/alias process matching behavior.
- **17:27:59** (`src/tmux.go`): Handle env flags in process matching parser
  Extended env wrapper parsing to skip env flags/assignments and fixed pass-through skip indexing so nested timeout/env/bash chains resolve correctly; added env -i regression.
- **17:47:07** (`src/tmux.go`): Fix shell payload agent detection false negatives
  Handle single-token shell -c payloads and split nested shell payloads across control operators so codex/claude detection works after && without matching text-only echoes.
- **17:47:08** (`src/regressions_test.go`): Add detectAgentProcess shell payload regressions
  Added tests for quoted single-token payload match, && multi-step payload match, and preserved non-match for echo text payload.
- **17:54:18** (`src/tmux.go`): Fix shell payload parser false negatives
  detectAgentProcess now parses shell -c payload segments (&&, ||, ;, |, newline) and supports single-token commands to resolve wrapped codex/claude invocations without text-only false positives; added regressions for quoted single-token and cd&&codex paths.
