# Breadcrumbs 2026-02-21

- **00:48:14** (`src/commands_session_smoke.go`): Add nested smoke command
  Implemented 'session smoke' with deterministic nested orchestration (levels 1-4), marker assertions, JSON summary, and optional keep-sessions behavior.
- **00:48:14** (`src/commands_session_state.go`): Add monitor expectation gates
  Added session monitor --expect any|terminal|marker with fail-fast mismatch reasons (expected_terminal_got_* / expected_marker_got_*).
- **00:48:14** (`src/commands_session_manage.go`): Add JSON output for manage commands
  Added --json support to session name/list/exists/kill/kill-all plus docs/help/test updates and tree --flat rows.
- **00:48:14** (`.agents/sdk-usage.md`): Refresh context docs for new session APIs
  Updated AGENTS/.agents/src context docs for smoke command, monitor expectation semantics, tree flat rows, and manage-command JSON support.
- **01:11:40**: Updated Lisa skill docs for smoke-first nesting
  Aligned skills/lisa/SKILL.md with current CLI monitor semantics, JSON command surface, and 4-level session smoke guidance; kept file at 500 lines.
- **01:11:40**: Logged changelog entry for lisa skill sync/build/install
  Added docs/changelog/260221.md entry documenting skill doc refresh plus verification commands (go build, ./lisa skills install, monitor help).
- **01:36:20**: Indexified Lisa skill into router + data docs
  Split skills/lisa/SKILL.md into compact router and added skills/lisa/data/{commands,recipes,runtime}.md for JIT context loading; preserved command/runtime semantics.
- **01:36:20**: Ran skill-optimiser postflight + skill install
  Wrote skills/lisa/.last-optimiser-hash, appended optimiser log row, validated table-row guard, and synced skill to ~/.codex and ~/.claude via ./lisa skills install.
- **04:40:45**: Added final changelog follow-up entry
  Appended non-duplicate docs/changelog/260221.md entry per changelog-auto clean-tree path and prepared commit-all.
- **04:51:28**: Lisa skill audit
  Executed comprehensive ./lisa command matrix, lifecycle/exit-code probes, nested smoke (4 levels), and creative lisa-in-lisa chain; captured discrepancies for monitor expect marker, tree metadata semantics, and kill-missing behavior.
- **04:51:29**: Lisa skill docs refined
  Updated skills/lisa SKILL.md + data/{commands,recipes,runtime}.md for LLM guardrails, nested trigger validation guidance, explicit defaults/JSON schemas, and active-vs-metadata session semantics; installed updated skill to ~/.codex and ~/.claude.
- **05:13:54**: Implemented Lisa CLI enhancements
  Added session tree --active-only, session monitor --json-min, session spawn --detect-nested diagnostics, and machine-readable errorCode payloads for JSON failure paths across JSON-enabled commands.
- **05:13:55**: Validated nested and regression coverage
  Added feature tests (active-only tree, json-min monitor, detect-nested spawn, JSON error codes), rebuilt ./lisa, ran go test ./..., and re-ran 4-level session smoke JSON verification.
- **06:20:36** (`skills/lisa/SKILL.md`): Refine Lisa skill guardrails
  Aligned SKILL.md with live CLI behavior: stdout/stderr JSON parsing rule, timeout finalStatus nuance, missing kill stderr note, and validated 1-4 level smoke confidence note.
- **06:20:37** (`skills/lisa/data/commands.md`): Update Lisa command contracts
  Added explicit subcommand tokenization rule, nestedDetection reason codes, monitor timeout nuance, capture noise filtering precision, and session kill stderr caveat.
- **06:20:38** (`skills/lisa/data/recipes.md`): Expand nested validation recipes
  Added nested trigger calibration sweep, 1-4 smoke loop recipe, and JSON parsing hygiene guidance for LLM orchestrators.
- **06:20:39** (`skills/lisa/data/runtime.md`): Clarify runtime capture filtering
  Updated runtime note to specify default raw capture filters MCP startup/auth noise and keep-noise opt-out behavior.
- **06:44:24** (`src/commands_session.go`): Add nested policy controls
  Implemented --nested-policy auto|force|off for session spawn, added policy-aware nestedDetection metadata, and enforced safe force/full-auto combination handling.
- **06:44:25** (`src/commands_session_state.go`): Add low-token capture/status features
  Added session status --json-min and session capture --delta-from (offset/@unix/RFC3339) with nextOffset metadata and capture-state tracking.
- **06:44:26** (`src/commands_session_manage.go`): Harden JSON mode stderr behavior
  Added session list --json-min and suppressed human stderr lines in session kill/kill-all JSON mode for deterministic machine parsing.
- **06:44:27** (`src/commands_session_tree.go`): Add session tree json-min
  Implemented session tree --json-min for reduced payload graph/row outputs while preserving full --json behavior.
- **06:44:28** (`src/commands_session_smoke.go`): Extend smoke with prompt style probe
  Added session smoke --prompt-style presets and pre-smoke nested detection probe validation in JSON summary.
- **06:44:29** (`src/utils.go`): Attach stderr policy to JSON payloads
  All JSON responses now include stderrPolicy to let orchestrators classify stderr as diagnostics stream.
- **06:44:30** (`skills/lisa/SKILL.md`): Refresh lisa skill for new CLI features
  Updated skill contracts/recipes/runtime with nested-policy, json-min surfaces, delta capture, prompt-style smoke probe, and stderrPolicy guidance.
- **06:44:31** (`.agents/sdk-usage.md`): Sync SDK usage context
  Documented new orchestration patterns: explicit nested policy control, json-min snapshots, delta capture loops, prompt-style smoke probe, and stderrPolicy parsing guidance.
- **06:47:21** (`src/commands_session_state.go`): Normalize monitor timeout status
  Session monitor timeout now emits finalStatus=timeout deterministically, removing active/idle variance in timeout payloads.
- **06:47:22** (`USAGE.md`): Document new monitoring/capture contracts
  Updated usage docs for nested-policy, json-min outputs, capture delta-from semantics, smoke prompt-style probe, stderrPolicy, and deterministic timeout finalStatus.
- **06:58:18** (`skills/lisa/SKILL.md`): Refine Lisa skill contracts
  Validated ./lisa command matrix (lifecycle, monitor expectations, capture delta, prompt-style probes, smoke levels 1-4); clarified project-root scope, status not_found exit behavior, delta nextOffset condition, and nested prompt verification loop.
- **06:58:19** (`skills/lisa/data/commands.md`): Sync command docs to observed output
  Documented case-insensitive nested hint matching, build-cmd no --project-root, and nestedDetection availability in build-cmd JSON.
- **06:58:20** (`skills/lisa/data/recipes.md`): Tighten nested wording recipes
  Switched nested spawn wording to ./lisa-first prompts, added lisa-inside-lisa phrase and uppercase probe examples, and clarified matcher behavior.
- **07:13:42** (`src/commands_session_preflight.go`): Add session preflight command
  Implemented session preflight with doctor-equivalent environment checks plus contract validation bundle (mode aliases, monitor marker guard, capture delta parsing, nested codex hint routing) and JSON/text outputs with pass/fail exit semantics.
- **07:13:43** (`src/commands_session_state.go`): Add monitor stream + capture json-min
  Added --stream-json polling events for session monitor and --json-min support for session capture (raw/transcript compact payloads, delta nextOffset preserved).
- **07:13:44** (`src/commands_agent.go`): Expand build-cmd project-root support
  agent build-cmd now accepts --project-root, emits projectRoot in JSON payload, and reuses shared doctor check collector.
- **07:13:45** (`skills/lisa/SKILL.md`): Refresh Lisa skill for preflight/stream/json-min
  Updated skill + data docs for session preflight, monitor --stream-json, capture --json-min, and project-root parity on build-cmd; installed to ~/.codex and ~/.claude.
- **15:55:20**: Add capabilities command
  Added lisa capabilities --json surface and help/run wiring with regression test.
- **16:06:59**: Close capabilities gaps
  Patched docs/index parity for capabilities, added capabilities command coverage tests (unknown-flag JSON + command-set drift guard), and documented local rebuild expectation for repo binary validation.
- **16:15:36**: Update lisa skill binary resolution
  Adjusted lisa skill and data docs to resolve LISA_BIN dynamically (prefer ./lisa when available, otherwise lisa on PATH), removed repo-local-only assumptions, and updated nested examples/prompts accordingly.
- **19:07:52**: Add codex --model support
  Added first-class --model flag for session spawn and agent build-cmd (codex-only), wired into command assembly, help/capabilities/docs, and tests including GPT-5.3-Codex-Spark.
- **19:07:55**: Refresh context docs
  Updated .agents/sdk-usage.md with codex --model guidance for session spawn/agent build-cmd and GPT-5.3-Codex-Spark example.
- **19:13:53**: Update lisa skill for codex model flag
  Updated skills/lisa docs (SKILL.md, data/commands.md, data/recipes.md) to include codex --model support and GPT-5.3-Codex-Spark examples.
- **20:05:23**: Skill/docs alignment + nested smoke validation
  Added detect-nested/snapshot/context-optimized flags/features; validated ./lisa nested smoke up to 4 levels; fixed skill wording for explicit nested triggers; synced skill v3.6.1 to codex.
- **20:13:29**: Optimise lisa skill router
  Applied skill-optimiser pattern: trimmed SKILL.md to crucial commands/router; moved validation details + feature backlog into data/validation.md and data/feature-ideas.md; updated optimiser hash and synced to codex skill.
- **20:32:18**: Refined lisa skill guidance after CLI matrix test
  Updated skills/lisa docs to remove stale model alias, add marker hygiene, clarify nested trigger/non-trigger wording, and extend feature backlog with scored ideas.
- **20:32:19**: Context docs synced for lisa skill
  Refreshed SKILL.md + recipes/commands/validation/feature-ideas to reflect observed behavior from ./lisa matrix + nested smoke runs (levels 1-4).
- **22:40:37**: lisa v5 drift closure
  Implemented session handoff/context-pack/route/guard, monitor --until-state, capture --cursor-file, tree --delta, smoke --model, preflight auto-model, skills doctor; updated help/capabilities/tests/USAGE/skill docs; validated with go test, skills doctor sync, detect-nested probes, guard shared-tmux, and 4-level smoke run.
