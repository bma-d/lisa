# Changelog - 260215

## 260215-00:00:00 - Reconcile documentation drift with current runtime

### Summary

Updated stale docs to reflect the current process-first classifier, expanded `src/` layout, real file/test counts, and current capture/state semantics.

### Changed

- Refreshed `docs/index.md` snapshot metrics and references.
- Rewrote `docs/project-overview.md` with current component breakdown and runtime decisions.
- Rewrote `docs/architecture.md` for process-first status flow, artifact lifecycle, and observability pipeline.
- Rewrote `docs/development-guide.md` with current test matrix, command flow, and environment controls.
- Rewrote `docs/source-tree-analysis.md` using current file counts and dependency map.
- Replaced `docs/project-scan-report.json` with an up-to-date machine-readable scan summary.
- Updated `agent.md` integration guide to match current states/capture behavior.

### QA Notes

- `go test ./...`
- `go test -race ./...`
- `go test -cover ./src`

## 260215-07:49:17 - Expand startup flow and interactive finish-hook coverage

### Summary

Aligned runtime/docs around startup-script execution and added e2e coverage for project-scoped `.claude/settings.json` finish hooks, including subagent wait handling.

### Added

- Added canonical `USAGE.md` CLI reference and latest scan snapshot doc.
- Added hermetic e2e coverage for exists/monitor/explain paths and interactive finish-hook paths.
- Added daily breadcrumbs for usage consolidation, startup changes, and hook-run-id integration notes.

### Changed

- Updated spawn path to launch wrapped startup command at tmux session creation via startup script flow.
- Updated interactive wrapper to export `LISA_RUN_ID` for hook subprocesses writing run-id-matching done sidecars.
- Updated session capture default project-root behavior to prefer cwd metadata with compatibility fallback.
- Refreshed root/docs/agent context files to match process-first classifier behavior and current command surface.
- Extended regression and stability tests to match startup flow changes and wrapper token contract.

### Files

- `.agents/sdk-usage.md`
- `.breadcrumbs/260215.md`
- `README.md`
- `USAGE.md`
- `agent.md`
- `docs/architecture.md`
- `docs/changelog/260215.md`
- `docs/development-guide.md`
- `docs/index.md`
- `docs/latest-scan.md`
- `docs/project-overview.md`
- `docs/project-scan-report.json`
- `docs/source-tree-analysis.md`
- `src/.agents/session-lifecycle.md`
- `src/claude_session_test.go`
- `src/commands_session.go`
- `src/commands_session_state.go`
- `src/coverage_cli_additional_test.go`
- `src/e2e_additional_fake_test.go`
- `src/e2e_claude_test.go`
- `src/e2e_codex_test.go`
- `src/e2e_interactive_fake_test.go`
- `src/regressions_test.go`
- `src/session_wrapper.go`
- `src/stability_findings_test.go`
- `src/tmux.go`

### QA Notes

- `go build -o lisa .`
- `go test ./src -run TestE2EInteractiveFinishHookWritesDoneAndRemovesItself -count=1`
- `go test ./src -run TestE2EInteractiveFinishHookWaitsForSubagentsBeforeDone -count=1`
- `go test ./...`

## 260215-16:43:57 - Detect waiting_input for idle interactive sessions

### Summary

Session monitor now emits `waiting_input` for interactive sessions when the agent process is alive but CPU has gone idle after the startup grace period.

### Changed

- Added CPU-busy threshold logic in status classification so interactive idle sessions classify as `waiting_input` (`interactive_idle_cpu`) while exec mode and busy processes remain `in_progress`.
- Added regression coverage for interactive waiting detection, grace-period suppression, and exec-mode exemption.
- Updated transcript-related regression expectations to match the new interactive idle classification path and documented the new signal behavior in state-machine context notes.

### Files

- `.breadcrumbs/260215.md`
- `src/.agents/state-machine.md`
- `src/regressions_test.go`
- `src/status.go`

### QA Notes

- `go test ./src/ -run "TestInteractiveSession|TestExecModeNever|TestPromptWaiting|TestComputeSessionStatusTranscript" -v`
- `go test ./src/ -v`
