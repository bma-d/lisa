# Changelog - 260210

## 260210-00:55:22 - Harden session status detection and artifact cleanup

### Summary
Improve session-state accuracy, artifact cleanup coverage, and doctor metadata reporting.

### Added
- Build metadata plumbing in app layer via `SetBuildInfo(...)` and new `src/build_info.go`.
- Regression tests covering prompt detection, zero-CPU process detection, cross-project cleanup, and doctor JSON payload.

### Changed
- Prompt-wait detection now inspects recent tail output instead of historical full-capture markers.
- Session artifact cleanup now resolves and removes matching artifacts across project-hash namespaces.

### Fixed
- Prevented stale "tokens used" / "press enter to send" lines from causing false `waiting_input` states.
- Corrected agent PID detection when matching process CPU is `0.0`.
- Removed hardcoded doctor JSON version; now reports runtime build metadata.

### Files
- `main.go`
- `src/build_info.go`
- `src/commands_agent.go`
- `src/session_files.go`
- `src/status.go`
- `src/tmux.go`
- `src/regressions_test.go`
- `.breadcrumbs/260210.md`

### QA Notes
- `go test ./...`
- `go vet ./...`
- `go run . doctor --json`

## 260210-01:59:02 - Ensure session termination despite cleanup failures

### Summary
Prioritize tmux session termination over artifact cleanup and enforce strict doctor flag parsing.

### Added
- Regression tests for unknown `doctor` flags and kill-order behavior under cleanup failures.

### Fixed
- `session kill` now attempts tmux termination before artifact cleanup, preventing cleanup errors from leaving sessions alive.
- `session kill-all` now attempts kill for every listed session before reporting cleanup failures.
- `doctor` now rejects unknown flags instead of silently ignoring them.

### Files
- `src/commands_agent.go`
- `src/commands_session.go`
- `src/regressions_test.go`
- `.breadcrumbs/260210.md`

### QA Notes
- `go test ./...`
- `go test -race ./...`
- `LISA_E2E_CLAUDE=1 go test ./...`
- Manual repro: forced cleanup failures for `session kill` and `session kill-all` verified sessions were still terminated.
