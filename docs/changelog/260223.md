# Changelog - 260223

## 260223-01:27:50 - Expand session contracts and multi-agent orchestration coverage

### Summary
Added new session contract/governance features, aligned skill docs with CLI capabilities, and hardened tests after multi-agent review cycles.

### Added
- `session contract-check` command for schema/docs contract validation.
- New orchestration flags: `--timeout-seconds`, `--since`, `--strict`, `--dedupe`, `--profile`, `--compress`, `--watch-json`, `--watch-interval`, `--watch-cycles`, `--export-artifacts`, `--contract-check`.
- Additional tests for help routing, capabilities error/help paths, and `skills doctor --contract-check` drift detection.

### Changed
- Updated `capabilities` + help surfaces to include all new commands/flags.
- Extended session explain/event tail cursor behavior and list watch streaming behavior.
- Updated Lisa skill docs to reflect current route/handoff/context-pack/smoke/list contracts.

### Fixed
- Closed command/flag drift between Lisa skill docs and actual CLI output.
- Removed test blind spots that could miss help/capability/contract regressions.

### Files
- `.breadcrumbs/260223.md`
- `skills/lisa/SKILL.md`
- `skills/lisa/data/commands.md`
- `skills/lisa/data/validation.md`
- `src/commands_capabilities.go`
- `src/commands_capabilities_test.go`
- `src/commands_session.go`
- `src/commands_session_explain.go`
- `src/commands_session_extended.go`
- `src/commands_session_manage.go`
- `src/commands_session_orchestration.go`
- `src/commands_session_smoke.go`
- `src/commands_session_state.go`
- `src/commands_session_tree.go`
- `src/commands_skills.go`
- `src/help.go`
- `src/help_test.go`
- `src/session_observability.go`
- `src/commands_session_governance.go`
- `src/commands_session_planning.go`
- `src/commands_skills_doctor_fix_test.go`

### QA Notes
- Run `go test ./...` and verify pass.
- Verify `go run . session contract-check --json` returns `ok:true`.
- Verify `go run . skills doctor --contract-check --json` returns `ok:true` for repo + installed targets.
- Manually sanity-check `session list --watch-json --watch-interval 1 --watch-cycles 1 --json-min` output shape.

## 260223-02:19:22 - Enforce watch-json minimal stream and close skill flag drift

### Summary
Fixed watch stream semantics, synced Lisa skill command flags, and added regression coverage.

### Added
- Regression tests for watch-json contract, handoff compression payload, smoke artifact export, route profile presets, and active-only list filtering.

### Changed
- `session list --watch-json` now always enforces `--json-min` output in watch loop invocations.
- Session list help text now documents the correct `--watch-interval` default (`2`).
- Lisa skill command docs now include missing monitor and orchestration flag surfaces.

### Fixed
- Prevented watch mode from emitting heavier full-json payloads when callers pass `--json`.
- Removed command/flag parity drift between skill docs and runtime capabilities.

### Files
- `.breadcrumbs/260223.md`
- `skills/lisa/data/commands.md`
- `src/commands_session_manage.go`
- `src/help.go`
- `src/session_watch_and_contract_regression_test.go`

### QA Notes
- Run `go test ./src -run 'TestCmdSessionListWatchForcesJSONMin|TestCmdSessionHandoffCompressZstdOmitsRecent|TestMaybeExportSmokeArtifactsCopiesWorkdir|TestCmdSessionRouteProfilePreset|TestCmdSessionListActiveOnlyWithoutNextAction|TestUsageDocSessionContract' -count=1`.
- Verify `./lisa skills doctor --repo-root . --contract-check --json` returns `ok:true`.
- Verify `./lisa session list --watch-json --watch-cycles 1 --project-root . --json` emits compact delta-json output.

## 260223-03:53:19 - Close review loop for objective/lane contracts and CI matrix

### Summary
Addressed all multi-agent review findings, hardened runtime contract enforcement, expanded direct command tests, and wired contract matrix into CI.

### Added
- Direct command tests for `session lane` CRUD JSON contract and `session memory --refresh --json` delta payload contract.
- CI `contract-matrix` job running `scripts/lisa-contract-matrix.sh` on push/PR.

### Changed
- `session send` objective reminder prepend now works when objective goal is empty but objective context exists.
- `session handoff` enforces lane contract requirements for schema v2 (`handoff_schema_v2_required`).
- Lisa skill docs command index and JSON surface now include `session budget-plan|objective|memory|lane`.

### Fixed
- Removed contract drift between skill docs and runtime for newly added session commands.
- Closed regression gaps around lane contracts and memory delta metadata outputs.

### Files
- `.github/workflows/ci.yml`
- `skills/lisa/data/commands.md`
- `src/commands_session.go`
- `src/commands_session_context.go`
- `src/commands_session_orchestration.go`
- `src/session_context_commands_direct_test.go`
- `src/session_send_handoff_contract_fix_test.go`
- `scripts/lisa-contract-matrix.sh`

### QA Notes
- Verify `go test ./...` passes.
- Verify `./scripts/lisa-contract-matrix.sh .` reports `pass=10 fail=0`.
- Verify `./lisa session contract-check --json` returns `ok:true`.

## 260223-03:52:49 - Close review loop for objective/lane contracts and CI matrix

### Summary
Addressed all multi-agent review findings, hardened runtime contract enforcement, expanded direct command tests, and wired contract matrix into CI.

### Added
- Direct command tests for  CRUD JSON contract and  delta payload contract.
- CI  job running PASS [capabilities-core]
PASS [objective-upsert]
PASS [lane-upsert]
PASS [spawn-lane-objective-dryrun]
PASS [detect-nested-trigger]
PASS [detect-nested-nontrigger]
PASS [route-queue]
PASS [budget-plan]
PASS [guard-policy]
PASS [smoke-llm-profile]

Contract matrix summary: pass=10 fail=0 on push/PR.

### Changed
-  objective reminder prepend now works when objective goal is empty but objective context exists.
-  enforces lane contract requirements for schema v2 ().
- Lisa skill docs command index and JSON surface now include .

### Fixed
- Removed contract drift between skill docs and runtime for newly added session commands.
- Closed regression gaps around lane contracts and memory delta metadata outputs.

### Files
- 
- 
- 
- 
- 
- 
- 
- PASS [capabilities-core]
PASS [objective-upsert]
PASS [lane-upsert]
PASS [spawn-lane-objective-dryrun]
PASS [detect-nested-trigger]
PASS [detect-nested-nontrigger]
PASS [route-queue]
PASS [budget-plan]
PASS [guard-policy]
PASS [smoke-llm-profile]

Contract matrix summary: pass=10 fail=0

### QA Notes
- Verify ?   	github.com/bma-d/lisa	[no test files]
ok  	github.com/bma-d/lisa/src	(cached) passes.
- Verify PASS [capabilities-core]
PASS [objective-upsert]
PASS [lane-upsert]
PASS [spawn-lane-objective-dryrun]
PASS [detect-nested-trigger]
PASS [detect-nested-nontrigger]
PASS [route-queue]
PASS [budget-plan]
PASS [guard-policy]
PASS [smoke-llm-profile]

Contract matrix summary: pass=10 fail=0 reports .
- Verify {"checks":[{"checked":15,"name":"schema_coverage","ok":true},{"checked":1,"name":"skill_commands_doc_read","ok":true},{"checked":48,"name":"skill_command_index_coverage","ok":true},{"checked":394,"name":"skill_flag_surface_coverage","ok":true}],"ok":true,"projectRoot":"/Users/joon/projects/twoj/tools/lisa","stderrPolicy":"diagnostic"} returns .

## 260223-05:16:04 - Stabilize codex interactive follow-up sends

### Summary
Hardened Codex interactive send behavior so same-session follow-up prompts submit reliably without manual extra Enter.

### Added
- Hermetic multi-turn interactive E2E coverage for same-session follow-up marker detection.
- Unit regression coverage for Codex interactive split-submit send path.

### Changed
- session send --text ... --enter now uses a staged submit path for Codex interactive sessions (text send + follow-up Enter).
- Objective reminder prefix in Codex interactive sends now stays single-line with user prompt text.
- tmux text-send buffer cleanup ordering now deletes buffer immediately after paste.

### Fixed
- Eliminated second-turn stalls in Codex interactive flows that previously required manual extra Enter.

### Files
- .agents/sdk-usage.md
- USAGE.md
- src/commands_session.go
- src/tmux.go
- src/e2e_interactive_followup_fake_test.go
- src/session_send_handoff_contract_fix_test.go
- src/session_send_state_test.go
- src/.agents/testing.md

### QA Notes
- Run go test ./... and verify full pass.
- Verify interactive same-session flow: spawn Codex interactive session, send first prompt, then session send --text ... --enter follow-up; confirm second marker is detected without manual nudge.
