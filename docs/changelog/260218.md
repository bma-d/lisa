# Changelog - 260218

## 260218-22:34:57 - Propagate exec failures and close monitor/fallback test gaps

### Summary

Fixed exec-mode failure classification so non-zero commands report crashed state/exit semantics correctly, and added explicit coverage for waiting-input monitor behavior and long-command script fallback.

### Added

- Added end-to-end exec-failure regression asserting `session monitor` returns `finalState=crashed` with exit code `2`.
- Added monitor regression asserting `--stop-on-waiting=false` does not terminate early on `waiting_input`.
- Added explicit long-command (`>500` chars) fallback regression asserting temp script path generation and `respawn-pane` script execution flow.

### Fixed

- Fixed wrapper exit-code propagation so exec command non-zero exits flow through to `__LISA_SESSION_DONE__:<runId>:<code>` instead of being flattened to `:0`.

### Files

- `.breadcrumbs/260218.md`
- `cvelist`
- `cvelist-html`
- `cvelist-our`
- `cvelist-our-html`
- `cvelist.diff`
- `docs/changelog/260218.md`
- `src/agent_command.go`
- `src/command_coverage_test.go`
- `src/e2e_exec_fake_test.go`
- `src/hardening_test.go`
- `src/regressions_test.go`
- `src/session_wrapper.go`

### QA Notes

- Verify failing exec command (`exit 7`) yields `session monitor --json` -> `finalState=crashed`, `exitReason=crashed`, process exit code `2`.
- Verify `session capture --raw --json` includes matching non-zero `__LISA_EXEC_DONE__` and `__LISA_SESSION_DONE__` markers for the same run id.
- Verify `session monitor --stop-on-waiting=false` does not stop on `waiting_input` and can time out when max polls are reached.
- Verify long command spawn/respawn path still executes through `/tmp/lisa-cmd-*` script and returns to shell cleanly.
